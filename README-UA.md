## Скрипт резервного копіювання баз даних MySQL

Цей Bash скрипт надає надійне та автоматизоване рішення для резервного копіювання баз даних MySQL, розроблене з урахуванням надійності та безпеки. Він використовує `mysqldump` для експорту баз даних, `tar` для архівування та включає функції суворої обробки помилок, сповіщення в Telegram та збереження старих резервних копій.

### Особливості

* **Сувора обробка помилок:** Використовує `set -euo pipefail` для негайного виходу при помилках та невизначених змінних, забезпечуючи надійність скрипта.
* **Сповіщення в Telegram:** Надсилає сповіщення про успіх/невдачу в режимі реального часу до вказаної групи Telegram, тримаючи вас в курсі стану резервного копіювання.
* **Конфігуровані резервні копії баз даних:** Підтримує резервне копіювання кількох баз даних MySQL з гнучкою конфігурацією для хоста, порту, користувача, пароля та імені бази даних.
* **Безпечна обробка облікових даних:** Наголошує на важливості використання змінних середовища для конфіденційних даних (токени Telegram, ID груп) та рекомендує `.my.cnf` для облікових даних MySQL для підвищення безпеки.
* **Керування тимчасовими каталогами:** Використовує безпечний тимчасовий каталог для файлів дампів, з механізмом `trap` для забезпечення належного очищення, навіть якщо скрипт завершується з помилкою.
* **Автоматичне архівування:** Стискає всі дампи баз даних в один архів `tar.gz` з відміткою часу.
* **Посилення дозволів:** Встановлює обмежувальні дозволи `600` для згенерованого архіву для підвищення безпеки.
* **Збереження старих резервних копій:** Автоматично видаляє архіви, старші за конфігуровану кількість днів, допомагаючи керувати дисковим простором.
* **Умовне резервне копіювання:** Містить приклад умовного резервного копіювання бази даних на основі поточної години.

### Передумови

* `bash` (рекомендовано версію 4.x або вище)
* Клієнтські утиліти `mysqldump`
* `curl` (для сповіщень Telegram)
* `tar`
* `find`

### Конфігурація

Перед запуском скрипта необхідно налаштувати наступне:

1.  **Токен бота Telegram та ID чату:**
    Встановіть їх як змінні середовища:
    ```bash
    export BOT_TOKEN="ВАШ_ТОКЕН_ТЕЛЕГРАМ_БОТА"
    export GROUP_ID="ВАШ_ID_ТЕЛЕГРАМ_ЧАТУ_АБО_ГРУПИ"
    ```
    Ви можете додати їх до свого `~/.bashrc` або `~/.profile` для збереження.

2.  **Конфігурації баз даних:**
    Відредагуйте асоціативний масив `DATABASES_TO_BACKUP` всередині скрипта. Формат: `"псевдонім:порт:користувач:пароль:ім'я_бази_даних[:хост]"`. `хост` є необов'язковим і за замовчуванням встановлюється на `127.0.0.1`.

    ```bash
    declare -A DATABASES_TO_BACKUP
    DATABASES_TO_BACKUP=(
        [main_app_db]="3306:backup_user:superSecurePassword:main_database"
        [analytics_data]="3306:analyst:anotherPa$$word:analytics_db:192.168.1.100"
    )
    ```
    **Примітка щодо безпеки:** Хоча пряме вбудовування паролів у скрипт показано для демонстрації, настійно рекомендується використовувати файл `.my.cnf` для облікових даних MySQL, щоб уникнути їхнього відображення у списках процесів. Додаткову інформацію дивіться в коментарях до скрипта.

3.  **Збереження резервних копій:**
    Відрегулюйте змінну `DAYS_TO_KEEP_BACKUPS` відповідно до бажаного періоду збереження (за замовчуванням 7 днів).

### Використання

1.  **Збережіть скрипт:** Збережіть скрипт у файл, наприклад, `mysql_backup.sh`.
2.  **Зробіть його виконуваним:** `chmod +x mysql_backup.sh`
3.  **Запустіть скрипт:** `./mysql_backup.sh`

Рекомендується планувати запуск цього скрипта періодично за допомогою `cron`.
